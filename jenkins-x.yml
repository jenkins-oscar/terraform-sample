#buildPack: terraform
buildPackGitURL: https://github.com/sharepointoscar/jenkins-x-classic
pipelineConfig:
  agent:
    image: sharepointoscar/terraform-buildpack:v4
  env:
  - name: AWS_ACCESS_KEY_ID
    valueFrom:
      secretKeyRef:
        key: AWS_ACCESS_KEY_ID
        name: aws-creds
  - name: AWS_SECRET_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        key: AWS_SECRET_ACCESS_KEY
        name: aws-creds
  pipelines:
    overrides:
    - pipeline: release
      stage: build
      type: before
      steps:
        - command: terraform
          args: ['init']
          name: output-terraform-init
        - command: echo ${TF_AWS_ACCESS_KEY_ID}
          name: output-aws-access_key_id
        - command: echo ${TF_AWS_SECRET_ACCESS_KEY}
          name: output-aws-secret_access_key_id
        
        - command: terraform
          args: ['destroy','-auto-approve']
          #args: ['apply','-auto-approve']
          name: terraform-apply-booooiii
  # pipelines:
  #     pullRequest:
  #       build:
  #         preSteps:
  #           - command: terraform
  #             args: ['init']
  #             name: output-terraform-init
  #           - command: env
  #             name: output-terraform-env            
  #           - command: echo ${TF_AWS_ACCESS_KEY_ID}
  #             name: output-aws-access_key_id
  #           - command: echo ${TF_AWS_SECRET_ACCESS_KEY}
  #             name: output-aws-secret_access_key_id
